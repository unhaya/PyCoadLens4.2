ご指摘ありがとうございます。以下に、**データベース連携とは独立した「静的コード解析」専用タブの設計図**を、LLM伝達に適した構成で再提示いたします。
「編集不可」「安全解析」「データベースとの分離設計」をすべて反映しています。

---

## 📐 設計図：静的コード解析タブ（編集不可・LSP連携）、解析結果タブの拡張。

### 🎯 **目的**

ユーザーがコードを「安全に参照」しながら、**明示的な解析操作によってLSPベースの静的解析を実行**し、解析結果（エラー・警告）を右側ウィンドウに表示する。「DB保存されたコード」や「仮想コード」を対象にして、データ更新と分離した検証環境を提供する。

---

## 🧱 技術構成

| 構成要素    | 使用技術                          |
| ------- | ----------------------------- |
| GUIタブ設計 | PyQt5 / PySide2 の QTabWidget  |
| コード表示   | QPlainTextEdit（読み取り専用）        |
| 解析ボタン   | QPushButton（ユーザー操作式）          |
| 結果表示    | QListWidget または QTreeView     |
| 解析エンジン  | `python-lsp-server` + plugins |
| 結果通信    | サブプロセス通信 / JSON経由             |

---

## 🧾 タブ構成イメージ

```
┌────────────────────────────────────────────────────────┐
│ タブ:【データベース連携】 | 【コード解析】 ← 今回の対象タブ │
└────────────────────────────────────────────────────────┘

【コード解析タブ】
┌─────────────────────┬────────────────────────────┬─────────────────────┐
│ コード選択リスト     │ 📄 コード表示エリア（編集不可） │ 🧪 解析結果ウィンドウ（右）│
├─────────────────────┴────────────────────────────┴─────────────────────┤
│         🔘 解析ボタンを押すと → エラー診断 → 結果を表示                          │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 🛠️ 実装要点

### ✅ コード表示エリア（中央）

```python
self.code_view = QPlainTextEdit()
self.code_view.setReadOnly(True)
self.code_view.setFont(QFont("Consolas", 10))
```
✅ コード解析ボタンを追加（手動実行）
```
self.analyze_button = QPushButton("解析")
self.analyze_button.clicked.connect(self.run_lsp_analysis)
```

### ✅ エラー表示ウィンドウ（右）

```python
self.error_list = QListWidget()
self.error_list.itemClicked.connect(self.jump_to_error)
```



---

## 🔄 ワークフロー詳細

1. ユーザーが【コード解析】タブに移動
2. コード一覧（ファイル or スニペット）から対象を選択
3. 中央エリアに対象コードが「読み取り専用」で表示される
4. ユーザーが🔘「解析」ボタンを押す

   * `pylsp` に一時ファイル or 入力文字列としてコード送信
   * LSPプロトコルで解析結果（Diagnostics）を受信
   * 結果を画面右側に整形して表示（例：行番号＋エラー内容）
5. エラー項目をクリックすると、右コードビューがそのブロックを表示して修正する。

---

## ⚠️ セキュリティ設計ポイント

* `setReadOnly(True)` で編集を物理的に禁止。ただしコピーはできるようにする。
* 実行・補完・自動解析なし（明示ボタン式）
* SQLiteとの連携はしない。このタブ内では書き込み発生しない設計。将来的には連携も検討。

---

## 🔌 LSP構成（推奨パッケージ）

```bash
pip install "python-lsp-server[all]" pylsp-mypy pylsp-flake8
```

> ※ subprocessでpylsp起動 → JSON受信 → パース表示の簡易構成も可

---

## 📘 LLM説明用備考

* 「解析ボタン」を押すことで、内部的に`pylsp`等のLSPをトリガーし、得られた診断結果をGUI上に明示。
* 「コードデータベースの更新」「保存処理」「LLMプロンプト生成」などとは**完全に分離**した設計としています。

---